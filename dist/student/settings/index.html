<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Peak English â€” Settings</title>
  <link rel="stylesheet" href="/static/app.css?v=1"/>
</head>
<body>
  <div class="bg-glow"></div>

  <header class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="/">Peak English</a>
      <nav class="nav" id="nav"></nav>
    </div>
  </header>

  <main class="page">
    <div class="wrap">
      
<section class="section section-wide">
  <div class="section-head head-row">
    <div>
      <h1 class="h1">Settings</h1>
      <p class="sub">Static demo: name + avatar stored in localStorage.</p>
    </div>
    <span class="badge" id="savedBadge" style="display:none;">Saved</span>
  </div>

  <div class="grid">
    <div class="col-5">
      <div class="panel">
        <div class="label">Avatar</div>
        <div class="muted small">Stored locally (demo).</div>
        <div class="divider"></div>

        <div class="row" style="justify-content:flex-start; gap:12px;">
          <img class="avatar avatar-lg" id="avatarPreview" style="display:none" alt="avatar">
          <div class="avatar avatar-lg avatar-fallback" id="avatarFallback">A</div>
          <div>
            <div class="label" id="dispName">Student</div>
            <div class="muted small" id="uname">@student</div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-7">
      <div class="panel">
        <form class="form" id="settingsForm">
          <label class="lbl">Display name</label>
          <input class="input" name="display_name" placeholder="Student">

          <label class="lbl">Goal</label>
          <select class="input" name="goal">
            <option>General English</option>
            <option>IELTS</option>
            <option>Business</option>
          </select>

          <label class="lbl">Avatar (demo)</label>
          <input class="input" type="file" name="avatar" accept="image/png,image/jpeg,image/webp">

          <button class="btn primary full" type="submit">Save</button>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
(async function(){
  if(localStorage.getItem("pe_role")!=="student") location.href="/";

  const saved = document.getElementById("savedBadge");
  const form = document.getElementById("settingsForm");
  const dn = document.getElementById("dispName");
  const un = document.getElementById("uname");
  const avp = document.getElementById("avatarPreview");
  const avf = document.getElementById("avatarFallback");

  function render(){
    const name = localStorage.getItem("pe_name") || "student";
    const disp = localStorage.getItem("pe_disp") || "Student";
    const av = localStorage.getItem("pe_avatar") || "";
    dn.textContent = disp;
    un.textContent = "@" + name;
    if(av){
      avp.src = av; avp.style.display="block"; avf.style.display="none";
    } else {
      avp.style.display="none"; avf.style.display="flex";
    }
  }
  render();

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();
    saved.style.display="none";
    const fd = new FormData(form);
    const disp = String(fd.get("display_name")||"").trim();
    if(disp) localStorage.setItem("pe_disp", disp);

    const file = fd.get("avatar");
    if(file && file instanceof File && file.size){
      const buf = await file.arrayBuffer();
      const b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
      const mime = file.type || "image/png";
      localStorage.setItem("pe_avatar", `data:${mime};base64,${b64}`);
    }
    saved.style.display="inline-flex";
    render();
  });
})();
</script>

    </div>
  </main>

  <script>
  (function(){
    const role = localStorage.getItem("pe_role") || "";
    const nav = document.getElementById("nav");
    function a(h, t, cls){
      const x=document.createElement("a");
      x.href=h; x.textContent=t; x.className=cls||"nav-link";
      return x;
    }
    if(role==="student"){
      nav.appendChild(a("/student/dashboard/","Dashboard"));
      nav.appendChild(a("/student/speaking/","Speaking"));
      nav.appendChild(a("/student/chat/","Chat"));
      nav.appendChild(a("/student/settings/","Settings"));
    } else if(role==="teacher"){
      nav.appendChild(a("/teacher/dashboard/","Dashboard"));
      nav.appendChild(a("/teacher/students/","Students"));
    }
    if(role){
      const lo = a("#","Logout","nav-pill");
      lo.addEventListener("click", (e)=>{
        e.preventDefault();
        localStorage.removeItem("pe_role");
        localStorage.removeItem("pe_name");
        localStorage.removeItem("pe_avatar");
        localStorage.removeItem("pe_disp");
        location.href="/";
      });
      nav.appendChild(lo);
    }
  })();
  </script>
</body>
</html>
